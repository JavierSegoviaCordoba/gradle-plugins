


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > PrebuildSiteTask</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.javiersc.hubdle.extensions.config.documentation.site</a>
</div>

<h1>Coverage Summary for Class: PrebuildSiteTask (com.javiersc.hubdle.extensions.config.documentation.site)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
<th class="coverageStat 
">
  Instruction, %
</th>
</tr>
<tr>
  <td class="name">PrebuildSiteTask</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/22)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/50)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/186)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1110)
  </span>
</td>
</tr>
  <tr>
    <td class="name">PrebuildSiteTask$buildBuildDotDocs$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/17)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PrebuildSiteTask$buildBuildDotDocs$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/33)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PrebuildSiteTask$buildBuildDotDocs$3$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PrebuildSiteTask$buildChangelogInDocs$1$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/19)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PrebuildSiteTask$buildProjectsInDocs$1$1$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/36)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PrebuildSiteTask$buildProjectsInDocs$1$1$2$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PrebuildSiteTask$Companion</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PrebuildSiteTask$Companion$inlined$sam$i$org_gradle_api_Action$0</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">PrebuildSiteTask$Companion$register$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PrebuildSiteTask$DocsNavigation</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/31)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/50)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/201)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1264)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;@file:Suppress(&quot;TooManyFunctions&quot;)
&nbsp;
&nbsp;package com.javiersc.hubdle.extensions.config.documentation.site
&nbsp;
&nbsp;import com.javiersc.kotlin.stdlib.endWithNewLine
&nbsp;import com.javiersc.kotlin.stdlib.removeDuplicateEmptyLines
&nbsp;import java.io.File
&nbsp;import javax.inject.Inject
&nbsp;import org.gradle.api.DefaultTask
&nbsp;import org.gradle.api.Project
&nbsp;import org.gradle.api.file.FileSystemOperations
&nbsp;import org.gradle.api.file.ProjectLayout
&nbsp;import org.gradle.api.provider.ListProperty
&nbsp;import org.gradle.api.provider.Property
&nbsp;import org.gradle.api.tasks.CacheableTask
&nbsp;import org.gradle.api.tasks.Input
&nbsp;import org.gradle.api.tasks.InputDirectory
&nbsp;import org.gradle.api.tasks.Internal
&nbsp;import org.gradle.api.tasks.Nested
&nbsp;import org.gradle.api.tasks.OutputDirectory
&nbsp;import org.gradle.api.tasks.PathSensitive
&nbsp;import org.gradle.api.tasks.PathSensitivity
&nbsp;import org.gradle.api.tasks.TaskAction
&nbsp;import org.gradle.api.tasks.TaskProvider
&nbsp;import org.gradle.kotlin.dsl.register
&nbsp;import org.jetbrains.kotlin.gradle.internal.ensureParentDirsCreated
&nbsp;
&nbsp;@CacheableTask
&nbsp;public abstract class PrebuildSiteTask
&nbsp;@Inject
&nbsp;constructor(
<b class="nc">&nbsp;    private val layout: ProjectLayout,</b>
<b class="nc">&nbsp;    private val fileSystemOperations: FileSystemOperations,</b>
<b class="nc">&nbsp;) : DefaultTask() {</b>
&nbsp;
<b class="nc">&nbsp;    init {</b>
<b class="nc">&nbsp;        group = &quot;documentation&quot;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    @get:Internal
&nbsp;    public val rootDirectory: File
<b class="nc">&nbsp;        get() = layout.projectDirectory.asFile</b>
&nbsp;
&nbsp;    @get:InputDirectory
&nbsp;    @get:PathSensitive(PathSensitivity.ABSOLUTE)
&nbsp;    public val dotDocsDirectory: File
<b class="nc">&nbsp;        get() = File(&quot;${layout.projectDirectory.asFile}/.docs/&quot;).apply(File::mkdirs)</b>
&nbsp;
&nbsp;    @get:Nested public abstract val projectsInfo: ListProperty&lt;ProjectInfo&gt;
&nbsp;
&nbsp;    @get:Input public abstract val allTests: Property&lt;Boolean&gt;
&nbsp;
&nbsp;    @get:Input public abstract val codeAnalysis: Property&lt;Boolean&gt;
&nbsp;
&nbsp;    @get:Input public abstract val codeCoverage: Property&lt;Boolean&gt;
&nbsp;
&nbsp;    @get:Input public abstract val codeQuality: Property&lt;Boolean&gt;
&nbsp;
&nbsp;    @get:OutputDirectory
&nbsp;    public val outputDotDocsDirectory: File
<b class="nc">&nbsp;        get() = dotDocsDirectory</b>
&nbsp;
&nbsp;    @get:OutputDirectory
&nbsp;    public val buildDotDocsDirectory: File
<b class="nc">&nbsp;        get() = File(&quot;${layout.projectDirectory.asFile}/build/.docs/&quot;).apply(File::mkdirs)</b>
&nbsp;
&nbsp;    @TaskAction
&nbsp;    public fun run() {
<b class="nc">&nbsp;        buildDotDocsDirectory(dotDocsDirectory)</b>
<b class="nc">&nbsp;        fileSystemOperations.buildBuildDotDocs(</b>
<b class="nc">&nbsp;            rootDirectory,</b>
<b class="nc">&nbsp;            dotDocsDirectory,</b>
<b class="nc">&nbsp;            buildDotDocsDirectory</b>
&nbsp;        )
<b class="nc">&nbsp;        buildChangelogInDocs(rootDirectory, fileSystemOperations)</b>
<b class="nc">&nbsp;        buildApiInDocs()</b>
<b class="nc">&nbsp;        buildProjectsInDocs(rootDirectory, projectsInfo.get(), fileSystemOperations)</b>
<b class="nc">&nbsp;        buildReportsInDocs(</b>
<b class="nc">&nbsp;            rootDirectory,</b>
<b class="nc">&nbsp;            allTests.get(),</b>
<b class="nc">&nbsp;            codeAnalysis.get(),</b>
<b class="nc">&nbsp;            codeCoverage.get(),</b>
<b class="nc">&nbsp;            codeQuality.get(),</b>
&nbsp;        )
<b class="nc">&nbsp;        sanitizeMkDocsFile()</b>
&nbsp;    }
&nbsp;
&nbsp;    public companion object {
&nbsp;        public const val name: String = &quot;preBuildSite&quot;
&nbsp;
&nbsp;        internal fun register(
&nbsp;            project: Project,
&nbsp;            configure: PrebuildSiteTask.() -&gt; Unit
&nbsp;        ): TaskProvider&lt;PrebuildSiteTask&gt; =
<b class="nc">&nbsp;            project.tasks.register&lt;PrebuildSiteTask&gt;(name) { configure(this) }</b>
&nbsp;    }
&nbsp;
&nbsp;    private fun buildDotDocsDirectory(dotDocsDirectory: File) {
<b class="nc">&nbsp;        val mkDocsFile = File(&quot;$dotDocsDirectory/mkdocs.yml&quot;)</b>
<b class="nc">&nbsp;        if (!mkDocsFile.exists()) {</b>
<b class="nc">&nbsp;            mkDocsFile.apply {</b>
<b class="nc">&nbsp;                ensureParentDirsCreated()</b>
<b class="nc">&nbsp;                createNewFile()</b>
<b class="nc">&nbsp;                writeText(defaultMkdocsYaml)</b>
<b class="nc">&nbsp;            }</b>
&nbsp;
<b class="nc">&nbsp;            File(&quot;$dotDocsDirectory/docs/css/all.css&quot;).apply {</b>
<b class="nc">&nbsp;                ensureParentDirsCreated()</b>
<b class="nc">&nbsp;                createNewFile()</b>
<b class="nc">&nbsp;                writeText(defaultAllCss)</b>
<b class="nc">&nbsp;            }</b>
&nbsp;
<b class="nc">&nbsp;            File(&quot;$dotDocsDirectory/docs/assets/empty.file&quot;).apply {</b>
<b class="nc">&nbsp;                ensureParentDirsCreated()</b>
<b class="nc">&nbsp;                createNewFile()</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private val defaultMkdocsYaml: String
&nbsp;        get() =
<b class="nc">&nbsp;            &quot;&quot;&quot; |# TODO: Change all necessary properties</b>
&nbsp;                |site_name: NAME # TODO
&nbsp;                |site_description: DESCRIPTION # TODO
&nbsp;                |site_author: AUTHOR # TODO
&nbsp;                |remote_branch: gh-pages
&nbsp;                |
&nbsp;                |repo_name: REPO NAME # TODO
&nbsp;                |repo_url: https://github.com/USER/REPO-NAME # TODO
&nbsp;                |
&nbsp;                |copyright: &#39;Copyright &amp;copy; 2021 AUTHOR&#39; # TODO
&nbsp;                |
&nbsp;                |theme:
&nbsp;                |  name: &#39;material&#39;
&nbsp;                |  language: &#39;en&#39;
&nbsp;                |  # TODO favicon: &#39;assets/favicon.png&#39;
&nbsp;                |  # TODO logo: &#39;assets/logo.svg&#39;
&nbsp;                |  font:
&nbsp;                |    text: &#39;Fira Sans&#39;
&nbsp;                |    code: &#39;JetBrains Mono&#39;
&nbsp;                |  palette:
&nbsp;                |    - media: &quot;(prefers-color-scheme: light)&quot;
&nbsp;                |      scheme: default
&nbsp;                |      primary: &#39;white&#39;
&nbsp;                |      accent: &#39;white&#39;
&nbsp;                |      toggle:
&nbsp;                |        icon: material/weather-sunny
&nbsp;                |        name: Switch to dark mode
&nbsp;                |    - media: &quot;(prefers-color-scheme: dark)&quot;
&nbsp;                |      primary: &#39;indigo&#39;
&nbsp;                |      accent: &#39;light blue&#39;
&nbsp;                |      scheme: slate
&nbsp;                |      toggle:
&nbsp;                |        icon: material/weather-night
&nbsp;                |        name: Switch to light mode
&nbsp;                |
&nbsp;                |nav:
&nbsp;                |  - Overview: index.md
&nbsp;                |
&nbsp;                |plugins:
&nbsp;                |  - search
&nbsp;                |
&nbsp;                |markdown_extensions:
&nbsp;                |  - admonition
&nbsp;                |  - smarty
&nbsp;                |  - codehilite:
&nbsp;                |      guess_lang: false
&nbsp;                |      linenums: True
&nbsp;                |  - footnotes
&nbsp;                |  - meta
&nbsp;                |  - toc:
&nbsp;                |      permalink: true
&nbsp;                |  - pymdownx.betterem:
&nbsp;                |      smart_enable: all
&nbsp;                |  - pymdownx.caret
&nbsp;                |  - pymdownx.details
&nbsp;                |  - pymdownx.inlinehilite
&nbsp;                |  - pymdownx.magiclink
&nbsp;                |  - pymdownx.smartsymbols
&nbsp;                |  - pymdownx.superfences
&nbsp;                |  - tables
&nbsp;                |
&nbsp;                |extra:
&nbsp;                |  social:
&nbsp;                |    - icon: fontawesome/brands/github
&nbsp;                |      link: https://github.com/USER # TODO
&nbsp;                |    - icon: fontawesome/brands/twitter
&nbsp;                |      link: https://twitter.com/USER # TODO
&nbsp;                |
&nbsp;                |extra_css:
&nbsp;                |  - css/all.css
&nbsp;                |
&nbsp;            &quot;&quot;&quot;
<b class="nc">&nbsp;                .trimMargin()</b>
&nbsp;
&nbsp;    private val defaultAllCss: String
&nbsp;        get() =
<b class="nc">&nbsp;            &quot;&quot;&quot; |code {</b>
&nbsp;                |    font-weight: 600;
&nbsp;                |}
&nbsp;                |
&nbsp;                |@media screen and (min-width: 76.1875em) {
&nbsp;                |    .md-nav--primary .md-nav__title {
&nbsp;                |        display: none;
&nbsp;                |    }
&nbsp;                |}
&nbsp;                |
&nbsp;                |.md-nav__link--active {
&nbsp;                |    font-weight: bold;
&nbsp;                |}
&nbsp;                |
&nbsp;            &quot;&quot;&quot;
<b class="nc">&nbsp;                .trimMargin()</b>
&nbsp;
&nbsp;    private fun FileSystemOperations.buildBuildDotDocs(
&nbsp;        rootDirectory: File,
&nbsp;        dotDocsDirectory: File,
&nbsp;        buildDotDocsDirectory: File,
&nbsp;    ) {
<b class="nc">&nbsp;        copy { copy -&gt;</b>
<b class="nc">&nbsp;            copy.from(dotDocsDirectory)</b>
<b class="nc">&nbsp;            copy.into(buildDotDocsDirectory)</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (File(&quot;$dotDocsDirectory/docs/index.md&quot;).exists().not()) {</b>
<b class="nc">&nbsp;            copy { copy -&gt;</b>
<b class="nc">&nbsp;                copy.from(&quot;$rootDirectory/README.md&quot;)</b>
<b class="nc">&nbsp;                copy.into(&quot;$rootDirectory/build/.docs/docs&quot;)</b>
<b class="nc">&nbsp;                copy.rename { fileName -&gt; fileName.replace(fileName, &quot;index.md&quot;) }</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            File(&quot;$rootDirectory/build/.docs/docs/index.md&quot;).apply {</b>
<b class="nc">&nbsp;                writeText(</b>
<b class="nc">&nbsp;                    readLines().joinToString(&quot;\n&quot;) { line -&gt;</b>
<b class="nc">&nbsp;                        line.replace(&quot;.docs/docs/assets&quot;, &quot;assets&quot;)</b>
&nbsp;                    }
&nbsp;                )
<b class="nc">&nbsp;            }</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private fun buildApiInDocs() {
<b class="nc">&nbsp;        val docsNavigation = getDocsNavigation()</b>
<b class="nc">&nbsp;        val navsPlusApiDocs =</b>
<b class="nc">&nbsp;            docsNavigation.navs +</b>
<b class="nc">&nbsp;                &quot;&quot;&quot;</b>
&nbsp;                |  - API docs:
&nbsp;                |    - Latest: api/
&nbsp;                |    - Snapshot: api/snapshot/
&nbsp;            &quot;&quot;&quot;
<b class="nc">&nbsp;                    .trimMargin()</b>
&nbsp;
<b class="nc">&nbsp;        writeNavigation(navsPlusApiDocs)</b>
&nbsp;    }
&nbsp;
&nbsp;    private fun buildChangelogInDocs(
&nbsp;        rootDirectory: File,
&nbsp;        fileSystemOperations: FileSystemOperations
&nbsp;    ) {
<b class="nc">&nbsp;        with(fileSystemOperations) {</b>
<b class="nc">&nbsp;            if (File(&quot;$rootDirectory/CHANGELOG.md&quot;).exists()) {</b>
<b class="nc">&nbsp;                copy { copy -&gt;</b>
<b class="nc">&nbsp;                    copy.from(&quot;$rootDirectory/CHANGELOG.md&quot;)</b>
<b class="nc">&nbsp;                    copy.into(&quot;$rootDirectory/build/.docs/docs&quot;)</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                File(&quot;$rootDirectory/build/.docs/docs/CHANGELOG.md&quot;).apply {</b>
<b class="nc">&nbsp;                    val content = readLines()</b>
<b class="nc">&nbsp;                    val firstVersionLine =</b>
<b class="nc">&nbsp;                        content.indexOfFirst { line -&gt;</b>
<b class="nc">&nbsp;                            line.contains(&quot;## [&quot;) &amp;&amp; !line.contains(&quot;[Unreleased]&quot;)</b>
<b class="nc">&nbsp;                        } - 1</b>
&nbsp;
<b class="nc">&nbsp;                    runCatching {</b>
<b class="nc">&nbsp;                        val contentUpdated =</b>
<b class="nc">&nbsp;                            (content.subList(0, 1) +</b>
<b class="nc">&nbsp;                                    content.subList(firstVersionLine, content.count()))</b>
<b class="nc">&nbsp;                                .joinToString(&quot;\n&quot;)</b>
<b class="nc">&nbsp;                        writeText(contentUpdated)</b>
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                }</b>
&nbsp;
<b class="nc">&nbsp;                val docsNavigation = getDocsNavigation()</b>
<b class="nc">&nbsp;                val navsPlusChangelog = docsNavigation.navs + &quot;  - Changelog: CHANGELOG.md&quot;</b>
&nbsp;
<b class="nc">&nbsp;                writeNavigation(navsPlusChangelog)</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    private fun buildProjectsInDocs(
&nbsp;        rootDirectory: File,
&nbsp;        projectsInfo: List&lt;ProjectInfo&gt;,
&nbsp;        fileSystemOperations: FileSystemOperations
&nbsp;    ) {
<b class="nc">&nbsp;        with(fileSystemOperations) {</b>
<b class="nc">&nbsp;            val projectsPath = &quot;$rootDirectory/build/.docs/docs/projects&quot;</b>
&nbsp;
<b class="nc">&nbsp;            projectsInfo.forEach { projectInfo -&gt;</b>
<b class="nc">&nbsp;                val projectsNavPath = &quot;$projectsPath/${projectInfo.filePath}&quot;</b>
&nbsp;
<b class="nc">&nbsp;                copy { copy -&gt;</b>
<b class="nc">&nbsp;                    copy.from(projectInfo.mdFile)</b>
<b class="nc">&nbsp;                    copy.into(projectsNavPath)</b>
<b class="nc">&nbsp;                    copy.rename { fileName -&gt; fileName.replace(fileName, &quot;${projectInfo.name}.md&quot;) }</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                File(&quot;$projectsNavPath/${projectInfo.name}.md&quot;).apply {</b>
<b class="nc">&nbsp;                    writeText(</b>
<b class="nc">&nbsp;                        readLines().joinToString(&quot;\n&quot;) { line -&gt;</b>
<b class="nc">&nbsp;                            line.replace(&quot;.docs/docs/assets&quot;, &quot;assets&quot;)</b>
&nbsp;                        }
&nbsp;                    )
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;            }</b>
&nbsp;
<b class="nc">&nbsp;            val docsNavigation = getDocsNavigation()</b>
<b class="nc">&nbsp;            val navProjects: List&lt;String&gt; =</b>
<b class="nc">&nbsp;                buildMap&lt;String, List&lt;String&gt;&gt; {</b>
<b class="nc">&nbsp;                        projectsInfo.forEach { projectInfo -&gt;</b>
<b class="nc">&nbsp;                            val fullPath =</b>
<b class="nc">&nbsp;                                &quot;projects/${projectInfo.projectPath.drop(1).replace(&quot;:&quot;, &quot;/&quot;)}&quot;</b>
<b class="nc">&nbsp;                            val parentPath = fullPath.replaceAfterLast(projectInfo.name, &quot;&quot;)</b>
<b class="nc">&nbsp;                            val projects = this[parentPath].orEmpty()</b>
<b class="nc">&nbsp;                            val paths = parentPath.split(&quot;/&quot;)</b>
<b class="nc">&nbsp;                            paths.reduce { previousPath, path -&gt;</b>
<b class="nc">&nbsp;                                val accumulatedPath = &quot;$previousPath/$path&quot;</b>
<b class="nc">&nbsp;                                put(accumulatedPath, this[accumulatedPath].orEmpty())</b>
<b class="nc">&nbsp;                                accumulatedPath</b>
&nbsp;                            }
<b class="nc">&nbsp;                            put(parentPath, projects + projectInfo.name)</b>
<b class="nc">&nbsp;                        }</b>
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                    .flatMap { (path, projects) -&gt;</b>
<b class="nc">&nbsp;                        val count = path.count { it == &#39;/&#39; } + 1</b>
<b class="nc">&nbsp;                        val indent = buildString { repeat(count) { append(&quot;  &quot;) } }</b>
<b class="nc">&nbsp;                        buildList {</b>
<b class="nc">&nbsp;                            add(&quot;- ${path.split(&#39;/&#39;).last()}:&quot;.prependIndent(indent))</b>
<b class="nc">&nbsp;                            addAll(</b>
<b class="nc">&nbsp;                                projects.map { project -&gt;</b>
<b class="nc">&nbsp;                                    &quot;- $project: $path/$project.md&quot;.prependIndent(&quot;$indent  &quot;)</b>
&nbsp;                                }
&nbsp;                            )
<b class="nc">&nbsp;                        }</b>
&nbsp;                    }
<b class="nc">&nbsp;                    .cleanNavProjects()</b>
&nbsp;
<b class="nc">&nbsp;            val navsPlusProjects = docsNavigation.navs + &quot;  - Projects:&quot; + navProjects</b>
&nbsp;
<b class="nc">&nbsp;            writeNavigation(navsPlusProjects)</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    private fun buildReportsInDocs(
&nbsp;        rootDirectory: File,
&nbsp;        allTests: Boolean,
&nbsp;        codeAnalysis: Boolean,
&nbsp;        codeCoverage: Boolean,
&nbsp;        codeQuality: Boolean,
&nbsp;    ) {
&nbsp;        fun MutableList&lt;String&gt;.createReportSection(title: String, pathAndFileName: String) {
<b class="nc">&nbsp;            val src = &quot;/reports-generated/$pathAndFileName&quot;</b>
<b class="nc">&nbsp;            val style = &quot;height: 65vh; width: 100vw; overflow: hidden&quot;</b>
<b class="nc">&nbsp;            val content =</b>
&nbsp;                &quot;&quot;&quot;
<b class="nc">&nbsp;                |# $title</b>
&nbsp;                |
<b class="nc">&nbsp;                |&lt;iframe src=&quot;$src&quot; style=&quot;$style&quot; frameborder=&quot;0&quot;&gt;&lt;/iframe&gt;</b>
&nbsp;                |
&nbsp;            &quot;&quot;&quot;
<b class="nc">&nbsp;                    .trimMargin()</b>
&nbsp;
<b class="nc">&nbsp;            File(&quot;$rootDirectory/build/.docs/docs/reports/$pathAndFileName.md&quot;).apply {</b>
<b class="nc">&nbsp;                ensureParentDirsCreated()</b>
<b class="nc">&nbsp;                createNewFile()</b>
<b class="nc">&nbsp;                writeText(content)</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            add(&quot;    - $title: reports/$pathAndFileName.md&quot;)</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        val navReports: String =</b>
<b class="nc">&nbsp;            buildList {</b>
<b class="nc">&nbsp;                    if (allTests &amp;&amp; codeAnalysis || codeCoverage || codeQuality) add(&quot;  - Reports:&quot;)</b>
<b class="nc">&nbsp;                    if (allTests) createReportSection(&quot;All tests&quot;, &quot;all-tests&quot;)</b>
<b class="nc">&nbsp;                    if (codeAnalysis) createReportSection(&quot;Code analysis&quot;, &quot;code-analysis&quot;)</b>
<b class="nc">&nbsp;                    if (codeCoverage) createReportSection(&quot;Code coverage&quot;, &quot;code-coverage&quot;)</b>
<b class="nc">&nbsp;                    if (codeQuality) createReportSection(&quot;Code quality&quot;, &quot;code-quality&quot;)</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                .joinToString(&quot;\n&quot;)</b>
&nbsp;
<b class="nc">&nbsp;        val docsNavigation = getDocsNavigation()</b>
&nbsp;
<b class="nc">&nbsp;        val navsPlusReports = docsNavigation.navs + navReports.lines()</b>
&nbsp;
<b class="nc">&nbsp;        writeNavigation(navsPlusReports)</b>
&nbsp;    }
&nbsp;
&nbsp;    private val mkDocsBuildFile: File
&nbsp;        get() =
<b class="nc">&nbsp;            File(&quot;${layout.projectDirectory.asFile}/build/.docs/mkdocs.yml&quot;).apply {</b>
<b class="nc">&nbsp;                ensureParentDirsCreated()</b>
<b class="nc">&nbsp;                createNewFile()</b>
<b class="nc">&nbsp;            }</b>
&nbsp;
<b class="nc">&nbsp;    private data class DocsNavigation(val index: Int, val navs: List&lt;String&gt;)</b>
&nbsp;
&nbsp;    private fun writeNavigation(newNavigations: List&lt;String&gt;) {
<b class="nc">&nbsp;        mkDocsBuildFile.writeText(</b>
<b class="nc">&nbsp;            buildList {</b>
<b class="nc">&nbsp;                    addAll(mkDocsBuildFile.readLines())</b>
<b class="nc">&nbsp;                    removeAt(getDocsNavigation().index)</b>
<b class="nc">&nbsp;                    removeAll(getDocsNavigation().navs)</b>
<b class="nc">&nbsp;                    add(&quot;&quot;)</b>
<b class="nc">&nbsp;                    add(&quot;nav:&quot;)</b>
<b class="nc">&nbsp;                    addAll(newNavigations)</b>
<b class="nc">&nbsp;                    add(&quot;&quot;)</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                .joinToString(&quot;\n&quot;)</b>
&nbsp;        )
&nbsp;    }
&nbsp;
&nbsp;    private fun getDocsNavigation(): DocsNavigation {
<b class="nc">&nbsp;        val content = mkDocsBuildFile.readLines()</b>
<b class="nc">&nbsp;        val navIndex = content.indexOfFirst { it.replace(&quot; &quot;, &quot;&quot;).startsWith(&quot;nav:&quot;, true) }</b>
<b class="nc">&nbsp;        return DocsNavigation(</b>
<b class="nc">&nbsp;            index = navIndex,</b>
&nbsp;            navs =
<b class="nc">&nbsp;                content.subList(navIndex + 1, content.count()).takeWhile {</b>
<b class="nc">&nbsp;                    it.replace(&quot; &quot;, &quot;&quot;).startsWith(&quot;-&quot;)</b>
&nbsp;                }
&nbsp;        )
&nbsp;    }
&nbsp;
&nbsp;    private fun List&lt;String&gt;.cleanNavProjects(): List&lt;String&gt; =
<b class="nc">&nbsp;        buildList {</b>
<b class="nc">&nbsp;                val lines = this@cleanNavProjects</b>
&nbsp;
&nbsp;                fun String.isReference() =
<b class="nc">&nbsp;                    filterNot(Char::isWhitespace).replaceBefore(&quot;:&quot;, &quot;&quot;).drop(1).isEmpty()</b>
&nbsp;
&nbsp;                fun String.isReferenceOf(reference: String) =
<b class="nc">&nbsp;                    trimIndent().takeWhile { it != &#39;:&#39; } ==</b>
<b class="nc">&nbsp;                        reference.trimIndent().takeWhile { it != &#39;:&#39; }</b>
&nbsp;
<b class="nc">&nbsp;                lines.reduce { previous, line -&gt;</b>
<b class="nc">&nbsp;                    when {</b>
<b class="nc">&nbsp;                        previous == line -&gt; {</b>
<b class="nc">&nbsp;                            removeLast()</b>
<b class="nc">&nbsp;                            add(line)</b>
<b class="nc">&nbsp;                            line</b>
&nbsp;                        }
<b class="nc">&nbsp;                        previous.isReference() &amp;&amp; line.isReferenceOf(previous) -&gt; {</b>
<b class="nc">&nbsp;                            add(previous.takeWhile(Char::isWhitespace) + line.trimIndent())</b>
<b class="nc">&nbsp;                            line</b>
&nbsp;                        }
<b class="nc">&nbsp;                        line.isReferenceOf(previous) &amp;&amp; line.isReference() -&gt; {</b>
<b class="nc">&nbsp;                            add(previous)</b>
<b class="nc">&nbsp;                            previous</b>
&nbsp;                        }
&nbsp;                        else -&gt; {
<b class="nc">&nbsp;                            add(previous)</b>
<b class="nc">&nbsp;                            line</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            .distinctBy(String::trimIndent)</b>
&nbsp;
&nbsp;    private fun sanitizeMkDocsFile() {
<b class="nc">&nbsp;        val content = mkDocsBuildFile.readLines().removeDuplicateEmptyLines().endWithNewLine()</b>
<b class="nc">&nbsp;        mkDocsBuildFile.writeText(content)</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-01-09 17:25</div>
</div>
</body>
</html>
