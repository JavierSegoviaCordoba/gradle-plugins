<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>InstallPreCommitTask.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">:</a> &gt; <a href="index.source.html" class="el_package">com.javiersc.hubdle.extensions.config.install.pre.commits.tasks</a> &gt; <span class="el_source">InstallPreCommitTask.kt</span></div><h1>InstallPreCommitTask.kt</h1><pre class="source lang-java linenums">package com.javiersc.hubdle.extensions.config.install.pre.commits.tasks

import com.javiersc.gradle.logging.extensions.debugColored
import com.javiersc.gradle.tasks.extensions.maybeRegisterLazily
import com.javiersc.hubdle.extensions.config.install.InstallTask
import java.io.File
import javax.inject.Inject
import org.gradle.api.DefaultTask
import org.gradle.api.Project
import org.gradle.api.file.ProjectLayout
import org.gradle.api.provider.Property
import org.gradle.api.tasks.CacheableTask
import org.gradle.api.tasks.Input
import org.gradle.api.tasks.OutputDirectory
import org.gradle.api.tasks.OutputFile
import org.gradle.api.tasks.TaskAction

@CacheableTask
public abstract class InstallPreCommitTask
@Inject
<span class="nc" id="L21">constructor(</span>
    layout: ProjectLayout,
<span class="nc" id="L23">) : InstallTask, DefaultTask() {</span>

<span class="nc" id="L25">    init {</span>
<span class="nc" id="L26">        group = &quot;install&quot;</span>
<span class="nc" id="L27">    }</span>

    @get:Input public abstract val preCommitName: Property&lt;String&gt;

    @OutputDirectory
<span class="nc" id="L32">    public val preCommitOutputDir: File =</span>
<span class="nc" id="L33">        layout.buildDirectory.asFile.get().resolve(&quot;install/pre-commits/&quot;)</span>

    @get:OutputFile
    public val preCommitOutputFile: File
<span class="nc" id="L37">        get() = preCommitOutputDir.resolve(&quot;${preCommitName.get()}.pre-commit&quot;)</span>

    @TaskAction
    override fun install() {
<span class="nc" id="L41">        logger.debugColored { &quot;Install pre-commit task&quot; }</span>
<span class="nc" id="L42">    }</span>

    public companion object {
        public const val name: String = &quot;installPreCommit&quot;

        internal fun register(project: Project) =
<span class="nc" id="L48">            project.tasks.maybeRegisterLazily&lt;InstallPreCommitTask&gt;(name).configureEach { task -&gt;</span>
<span class="nc" id="L49">                task.preCommitName.set(&quot;&quot;)</span>
<span class="nc" id="L50">            }</span>
    }
}

internal fun InstallPreCommitTask.createInstallPreCommitGradleTask() {
<span class="nc" id="L55">    val headerText = &quot;[${preCommitName.get()} autogenerated by `Hubdle` plugin]&quot;</span>
<span class="nc" id="L56">    val text =</span>
        &quot;&quot;&quot;
            |
<span class="nc" id="L59">            |# $headerText</span>
<span class="nc" id="L60">            |./gradlew ${preCommitName.get()}</span>
            |
        &quot;&quot;&quot;
<span class="nc" id="L63">            .trimMargin()</span>

<span class="nc" id="L65">    preCommitOutputFile.writeText(text)</span>
<span class="nc" id="L66">}</span>

internal val ProjectLayout.preCommitFile: File
<span class="nc" id="L69">    get() = projectDirectory.file(&quot;.git/hooks/pre-commit&quot;).asFile</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>